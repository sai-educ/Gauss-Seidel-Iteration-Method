<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gauss-Seidel Method ‚Äî 3D Visualization</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  body {
    font-family: ui-sans-serif, system-ui, -apple-system, sans-serif;
    background: linear-gradient(135deg, #0a1628 0%, #1a3a5f 100%);
    color: #e8f4ff;
    overflow: hidden;
    height: 100vh;
  }
  
  #container {
    position: relative;
    width: 100vw;
    height: 100vh;
  }
  
  #canvas-container {
    width: 100%;
    height: 100%;
  }
  
  #controls {
    position: absolute;
    top: 20px;
    left: 20px;
    background: rgba(10, 22, 40, 0.9);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: 12px;
    padding: 20px;
    max-width: 350px;
    backdrop-filter: blur(10px);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
  }
  
  h1 {
    font-size: 20px;
    margin-bottom: 12px;
    color: #3b82f6;
    font-weight: 700;
  }
  
  .section {
    margin: 15px 0;
  }
  
  .section-title {
    font-size: 13px;
    color: #60a5fa;
    margin-bottom: 8px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .input-group {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
    margin: 8px 0;
  }
  
  input {
    background: rgba(26, 58, 95, 0.6);
    border: 1px solid rgba(59, 130, 246, 0.3);
    color: #e8f4ff;
    padding: 8px;
    border-radius: 6px;
    font-size: 13px;
    text-align: center;
    outline: none;
    transition: border-color 0.2s;
  }
  
  input:focus {
    border-color: #3b82f6;
  }
  
  button {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    border: none;
    color: white;
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 600;
    margin: 4px;
    transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
  }
  
  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
  }
  
  button:active {
    transform: translateY(0);
  }
  
  button.secondary {
    background: linear-gradient(135deg, #1e3a5f, #0f2544);
  }
  
  button.success {
    background: linear-gradient(135deg, #10b981, #059669);
  }
  
  .button-group {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }
  
  #status {
    background: rgba(26, 58, 95, 0.4);
    border-left: 3px solid #3b82f6;
    padding: 12px;
    border-radius: 6px;
    font-size: 12px;
    line-height: 1.6;
    margin-top: 12px;
  }
  
  .status-value {
    color: #10b981;
    font-weight: 600;
  }
  
  #info {
    position: absolute;
    bottom: 20px;
    left: 20px;
    background: rgba(10, 22, 40, 0.9);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: 12px;
    padding: 15px;
    max-width: 350px;
    backdrop-filter: blur(10px);
    font-size: 12px;
    line-height: 1.6;
  }
  
  .legend {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 6px 0;
  }
  
  .legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
  }
  
  .loading {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    font-size: 18px;
    color: #3b82f6;
  }
  
  @media (max-width: 768px) {
    #controls, #info {
      max-width: calc(100vw - 40px);
    }
  }
</style>
</head>
<body>
  <div id="container">
    <div id="canvas-container"></div>
    
    <div id="controls">
      <h1>üåê Gauss-Seidel 3D</h1>
      
      <div class="section">
        <div class="section-title">System: Ax = b (3√ó3)</div>
        <div style="font-size:11px; color:#b3d9ff; margin-bottom:8px">Row 1:</div>
        <div class="input-group">
          <input id="a11" type="number" value="10" step="0.5">
          <input id="a12" type="number" value="1" step="0.5">
          <input id="a13" type="number" value="1" step="0.5">
        </div>
        <div style="font-size:11px; color:#b3d9ff; margin:6px 0 8px 0">Row 2:</div>
        <div class="input-group">
          <input id="a21" type="number" value="1" step="0.5">
          <input id="a22" type="number" value="10" step="0.5">
          <input id="a23" type="number" value="1" step="0.5">
        </div>
        <div style="font-size:11px; color:#b3d9ff; margin:6px 0 8px 0">Row 3:</div>
        <div class="input-group">
          <input id="a31" type="number" value="1" step="0.5">
          <input id="a32" type="number" value="1" step="0.5">
          <input id="a33" type="number" value="10" step="0.5">
        </div>
        
        <div style="font-size:11px; color:#b3d9ff; margin:12px 0 8px 0">Constants b:</div>
        <div class="input-group">
          <input id="b1" type="number" value="12" step="0.5">
          <input id="b2" type="number" value="12" step="0.5">
          <input id="b3" type="number" value="12" step="0.5">
        </div>
      </div>
      
      <div class="section">
        <div class="button-group">
          <button onclick="startIteration()">‚ñ∂ Start</button>
          <button onclick="resetView()" class="secondary">Reset</button>
          <button onclick="loadPreset()" class="secondary">Preset</button>
        </div>
      </div>
      
      <div id="status">
        <div><strong>Iteration:</strong> <span class="status-value" id="iter">0</span></div>
        <div><strong>Error:</strong> <span class="status-value" id="error">‚Äì</span></div>
        <div style="margin-top:8px; font-size:11px; color:#b3d9ff">
          Solution: <span id="solution">[0, 0, 0]</span>
        </div>
      </div>
    </div>
    
    <div id="info">
      <div style="font-weight:600; margin-bottom:8px; color:#3b82f6">Legend</div>
      <div class="legend">
        <div class="legend-dot" style="background:#3b82f6"></div>
        <div>Iteration Path (blue spheres)</div>
      </div>
      <div class="legend">
        <div class="legend-dot" style="background:#10b981"></div>
        <div>True Solution (green)</div>
      </div>
      <div class="legend">
        <div class="legend-dot" style="background:#f59e0b"></div>
        <div>Current Position (orange)</div>
      </div>
      <div style="margin-top:10px; font-size:11px; color:#b3d9ff">
        <strong>Controls:</strong> Drag to rotate ‚Ä¢ Scroll to zoom ‚Ä¢ Right-drag to pan
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    let scene, camera, renderer, controls;
    let iterationPoints = [];
    let currentSphere, trueSolutionSphere;
    let pathLine;
    let animationId;
    
    // Initialize Three.js scene
    function init() {
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x0a1628);
      scene.fog = new THREE.Fog(0x0a1628, 10, 50);
      
      // Camera
      camera = new THREE.PerspectiveCamera(
        60,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      camera.position.set(8, 8, 8);
      camera.lookAt(0, 0, 0);
      
      // Renderer
      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      document.getElementById('canvas-container').appendChild(renderer.domElement);
      
      // Lights
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambientLight);
      
      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight.position.set(10, 10, 10);
      scene.add(directionalLight);
      
      const pointLight = new THREE.PointLight(0x3b82f6, 0.5);
      pointLight.position.set(-5, 5, -5);
      scene.add(pointLight);
      
      // Add coordinate axes
      const axesHelper = new THREE.AxesHelper(5);
      scene.add(axesHelper);
      
      // Add grid
      const gridHelper = new THREE.GridHelper(10, 10, 0x1a3a5f, 0x0f2544);
      scene.add(gridHelper);
      
      // Add axis labels
      addAxisLabels();
      
      // Simple orbit controls (manual implementation)
      let isDragging = false;
      let previousMousePosition = { x: 0, y: 0 };
      
      renderer.domElement.addEventListener('mousedown', (e) => {
        isDragging = true;
        previousMousePosition = { x: e.clientX, y: e.clientY };
      });
      
      renderer.domElement.addEventListener('mousemove', (e) => {
        if (isDragging) {
          const deltaX = e.clientX - previousMousePosition.x;
          const deltaY = e.clientY - previousMousePosition.y;
          
          const rotationSpeed = 0.005;
          
          // Rotate camera around the origin
          const radius = camera.position.length();
          const theta = Math.atan2(camera.position.x, camera.position.z);
          const phi = Math.acos(camera.position.y / radius);
          
          const newTheta = theta - deltaX * rotationSpeed;
          const newPhi = Math.max(0.1, Math.min(Math.PI - 0.1, phi + deltaY * rotationSpeed));
          
          camera.position.x = radius * Math.sin(newPhi) * Math.sin(newTheta);
          camera.position.y = radius * Math.cos(newPhi);
          camera.position.z = radius * Math.sin(newPhi) * Math.cos(newTheta);
          
          camera.lookAt(0, 0, 0);
          
          previousMousePosition = { x: e.clientX, y: e.clientY };
        }
      });
      
      renderer.domElement.addEventListener('mouseup', () => {
        isDragging = false;
      });
      
      renderer.domElement.addEventListener('wheel', (e) => {
        e.preventDefault();
        const zoomSpeed = 0.1;
        const delta = e.deltaY > 0 ? 1 + zoomSpeed : 1 - zoomSpeed;
        camera.position.multiplyScalar(delta);
      });
      
      // Handle window resize
      window.addEventListener('resize', onWindowResize);
      
      animate();
    }
    
    function addAxisLabels() {
      const loader = new THREE.FontLoader();
      const createTextLabel = (text, position, color) => {
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.width = 256;
        canvas.height = 128;
        
        context.fillStyle = color;
        context.font = 'Bold 48px Arial';
        context.textAlign = 'center';
        context.textBaseline = 'middle';
        context.fillText(text, 128, 64);
        
        const texture = new THREE.CanvasTexture(canvas);
        const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
        const sprite = new THREE.Sprite(spriteMaterial);
        sprite.position.copy(position);
        sprite.scale.set(1, 0.5, 1);
        scene.add(sprite);
      };
      
      createTextLabel('x‚ÇÅ', new THREE.Vector3(6, 0, 0), '#ef4444');
      createTextLabel('x‚ÇÇ', new THREE.Vector3(0, 6, 0), '#10b981');
      createTextLabel('x‚ÇÉ', new THREE.Vector3(0, 0, 6), '#3b82f6');
    }
    
    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }
    
    function animate() {
      animationId = requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }
    
    function getSystem() {
      const A = [
        [parseFloat(document.getElementById('a11').value), 
         parseFloat(document.getElementById('a12').value), 
         parseFloat(document.getElementById('a13').value)],
        [parseFloat(document.getElementById('a21').value), 
         parseFloat(document.getElementById('a22').value), 
         parseFloat(document.getElementById('a23').value)],
        [parseFloat(document.getElementById('a31').value), 
         parseFloat(document.getElementById('a32').value), 
         parseFloat(document.getElementById('a33').value)]
      ];
      
      const b = [
        parseFloat(document.getElementById('b1').value),
        parseFloat(document.getElementById('b2').value),
        parseFloat(document.getElementById('b3').value)
      ];
      
      return { A, b };
    }
    
    function gaussSeidelIteration(x, A, b) {
      const newX = [...x];
      for (let i = 0; i < 3; i++) {
        let sum = b[i];
        for (let j = 0; j < 3; j++) {
          if (j !== i) {
            sum -= A[i][j] * newX[j];
          }
        }
        newX[i] = sum / A[i][i];
      }
      return newX;
    }
    
    function calculateError(x1, x2) {
      let maxError = 0;
      for (let i = 0; i < 3; i++) {
        const err = Math.abs(x1[i] - x2[i]);
        if (err > maxError) maxError = err;
      }
      return maxError;
    }
    
    function addSphere(position, color, size = 0.1) {
      const geometry = new THREE.SphereGeometry(size, 16, 16);
      const material = new THREE.MeshStandardMaterial({ 
        color: color,
        emissive: color,
        emissiveIntensity: 0.3,
        metalness: 0.5,
        roughness: 0.3
      });
      const sphere = new THREE.Mesh(geometry, material);
      sphere.position.set(position[0], position[1], position[2]);
      scene.add(sphere);
      return sphere;
    }
    
    function updatePathLine() {
      if (pathLine) {
        scene.remove(pathLine);
      }
      
      if (iterationPoints.length < 2) return;
      
      const points = iterationPoints.map(p => new THREE.Vector3(p[0], p[1], p[2]));
      const geometry = new THREE.BufferGeometry().setFromPoints(points);
      const material = new THREE.LineBasicMaterial({ 
        color: 0x3b82f6,
        linewidth: 2
      });
      pathLine = new THREE.Line(geometry, material);
      scene.add(pathLine);
    }
    
    async function startIteration() {
      // Clear previous iteration
      iterationPoints.forEach(point => {
        const sphere = scene.children.find(child => 
          child.position.x === point[0] && 
          child.position.y === point[1] && 
          child.position.z === point[2]
        );
        if (sphere) scene.remove(sphere);
      });
      
      if (pathLine) scene.remove(pathLine);
      if (currentSphere) scene.remove(currentSphere);
      if (trueSolutionSphere) scene.remove(trueSolutionSphere);
      
      iterationPoints = [];
      
      const { A, b } = getSystem();
      let x = [0, 0, 0];
      iterationPoints.push([...x]);
      
      // Calculate and show true solution
      const trueSolution = solveDirect(A, b);
      trueSolutionSphere = addSphere(trueSolution, 0x10b981, 0.15);
      
      const tolerance = 0.0001;
      const maxIterations = 50;
      let iteration = 0;
      
      while (iteration < maxIterations) {
        const oldX = [...x];
        x = gaussSeidelIteration(x, A, b);
        const error = calculateError(x, oldX);
        
        iterationPoints.push([...x]);
        addSphere(x, 0x3b82f6, 0.08);
        updatePathLine();
        
        // Update current position
        if (currentSphere) scene.remove(currentSphere);
        currentSphere = addSphere(x, 0xf59e0b, 0.12);
        
        // Update UI
        document.getElementById('iter').textContent = iteration + 1;
        document.getElementById('error').textContent = error.toFixed(6);
        document.getElementById('solution').textContent = 
          `[${x.map(v => v.toFixed(3)).join(', ')}]`;
        
        iteration++;
        
        if (error < tolerance) {
          document.getElementById('status').style.borderLeftColor = '#10b981';
          break;
        }
        
        await new Promise(resolve => setTimeout(resolve, 500));
      }
    }
    
    function solveDirect(A, b) {
      // Simple Gaussian elimination for 3x3
      const n = 3;
      const aug = A.map((row, i) => [...row, b[i]]);
      
      for (let i = 0; i < n; i++) {
        let maxRow = i;
        for (let k = i + 1; k < n; k++) {
          if (Math.abs(aug[k][i]) > Math.abs(aug[maxRow][i])) {
            maxRow = k;
          }
        }
        [aug[i], aug[maxRow]] = [aug[maxRow], aug[i]];
        
        for (let k = i + 1; k < n; k++) {
          const factor = aug[k][i] / aug[i][i];
          for (let j = i; j <= n; j++) {
            aug[k][j] -= factor * aug[i][j];
          }
        }
      }
      
      const x = new Array(n);
      for (let i = n - 1; i >= 0; i--) {
        x[i] = aug[i][n];
        for (let j = i + 1; j < n; j++) {
          x[i] -= aug[i][j] * x[j];
        }
        x[i] /= aug[i][i];
      }
      
      return x;
    }
    
    function resetView() {
      camera.position.set(8, 8, 8);
      camera.lookAt(0, 0, 0);
      
      if (pathLine) scene.remove(pathLine);
      if (currentSphere) scene.remove(currentSphere);
      if (trueSolutionSphere) scene.remove(trueSolutionSphere);
      
      iterationPoints.forEach(point => {
        const sphere = scene.children.find(child => 
          child.position.x === point[0] && 
          child.position.y === point[1] && 
          child.position.z === point[2]
        );
        if (sphere) scene.remove(sphere);
      });
      
      iterationPoints = [];
      document.getElementById('iter').textContent = '0';
      document.getElementById('error').textContent = '‚Äì';
      document.getElementById('solution').textContent = '[0, 0, 0]';
      document.getElementById('status').style.borderLeftColor = '#3b82f6';
    }
    
    function loadPreset() {
      document.getElementById('a11').value = '10';
      document.getElementById('a12').value = '1';
      document.getElementById('a13').value = '1';
      document.getElementById('a21').value = '1';
      document.getElementById('a22').value = '10';
      document.getElementById('a23').value = '1';
      document.getElementById('a31').value = '1';
      document.getElementById('a32').value = '1';
      document.getElementById('a33').value = '10';
      document.getElementById('b1').value = '12';
      document.getElementById('b2').value = '12';
      document.getElementById('b3').value = '12';
      
      resetView();
    }
    
    // Initialize on load
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
